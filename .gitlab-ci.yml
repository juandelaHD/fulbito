# .gitlab-ci.yml
stages:
  - build
  - test

variables:
  MAVEN_CLI_OPTS: "-s .m2/settings.xml --batch-mode --errors --fail-at-end"

# Job to build the project
build:
  image: maven:3.8.8-jdk-21
  stage: build
  script:
    - mvn $MAVEN_CLI_OPTS clean compile
  artifacts:
    expire_in: 1 hour
    paths:
      - target/

# Job to run tests
test:
  image: maven:3.8.8-jdk-11
  stage: test
  script:
    - mvn $MAVEN_CLI_OPTS test
  artifacts:
    when: always
    reports:
      junit: target/surefire-reports/*.xml   # Test report
    paths:
      - target/surefire-reports/
  #
  rules:
    - if: $CI_MERGE_REQUEST_ID             # pipeline in merge request
    - when: never

